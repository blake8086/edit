<html>
	<head>
		<title></title>
		<style>
			body { margin: 0; padding: 0; }
			#editor {
		        position: absolute;
		        width: 100%;
		        height: 100%;
		    }
		</style>
		<script src="jquery.min.js"></script>
		<script src="json2.js"></script>
	    <script src="ace/build/src/ace.js" type="text/javascript" charset="utf-8"></script>
		<script src="ace/build/src/mode-html.js" type="text/javascript" charset="utf-8"></script>

		<script>
			$(function() {
		        var editor = ace.edit("editor");
				var HTMLMode = require("ace/mode/html").Mode;
				editor.getSession().setMode(new HTMLMode());

				var filename = window.prompt('Paste filename of file to edit:');
				window.location.hash = filename;
                document.title = filename.replace(/^.+\//, '');
				
				var commandPressed = false;
				
				$.get('/file?path=' + filename, function(data) {
					editor.getSession().setValue(data);
				});

				$(document).keydown(function(e) {
					if (commandPressed && e.keyCode == 83) {
						e.preventDefault();
						console.log('saving...');
						save();
					}
					commandPressed = (e.keyCode == 91);
				});
				
				function save() {
					$.post('/save', {
						fileName: encodeURIComponent(filename),
						fileContents: editor.getSession().getValue(),
					}, function(data, status, xhr) {});
				}
			});
		</script>
	</head>
	<body>
		<div id="editor"></div>
	</body>
</html>
